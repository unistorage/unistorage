{% extends 'base.html' %}
{% set active_page = 'users' %}


{% block static %}
  {{ super() }}

  {% assets 'statistics_js' %}
    <script src="{{ ASSET_URL }}"></script>
  {% endassets %}
  <script src=""></script>
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script type="text/javascript">
      google.load('visualization', '1.0', {'packages':['corechart']});
  </script>
{% endblock %}


{% block content %}
  <h3>Статистика пользователя {{ user.name }}</h3>

  <form action="" method="GET" class="form-horizontal"> 
    <div class="control-group">
        <label class="control-label">Тип контента:</label>
    <div class="controls">
    <select name="type_id">
      <option></option>
      {% for type_id in type_ids %}
      <option value="{{ type_id }}" {% if request.args.type_id == type_id %}selected{% endif %}>
        {{ type_id }}
      </option>
      {% endfor %}
    </select>
    </div>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn">Показать</button>
    </div>
  </form>

  {% if not statistics %}
    <p>Статистика отсутствует.</p>
  {% else %}
    <dl class="dl-horizontal">
      <dt>Количество файлов</dt>
      <dd>{{ summary.files_count }}</dd>
      <dt>Объём файлов</dt>
      <dd>{{ summary.files_size }} МБ</dd>
    </dl>

    <script type="text/javascript">
        var statisticsData = google.visualization.arrayToDataTable([
            ['День', 'Объем', 'Количество'],
            {% for entry in statistics -%}
                [
                    moment.utc({{ entry.timestamp.strftime('%s') }} * 1000).format('DD.MM'),
                    {{ entry.files_size }},
                    {{ entry.files_count }},
                ],
            {%- endfor %}
        ]);

        {% for entry in statistics %}
            statisticsData.setFormattedValue({{ loop.index0 }}, 1, {{ entry.files_size }} + " МБ");
        {%- endfor %}
    </script>

    <div id="plot" style="width:100%;height:500px;"></div>
  {% endif %}
{% endblock %}
